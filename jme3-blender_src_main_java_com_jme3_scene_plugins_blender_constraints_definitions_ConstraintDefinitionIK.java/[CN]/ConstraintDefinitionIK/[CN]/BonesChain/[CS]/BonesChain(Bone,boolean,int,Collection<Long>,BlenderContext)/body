{
  if (bone != null) {
    ConstraintHelper constraintHelper=blenderContext.getHelper(ConstraintHelper.class);
    if (!useTail) {
      bone=bone.getParent();
    }
    while (bone != null && (bonesAffected <= 0 || this.size() < bonesAffected)) {
      BoneContext boneContext=blenderContext.getBoneContext(bone);
      this.add(boneContext);
      alteredOmas.add(boneContext.getBoneOma());
      Space space=this.size() < bonesAffected ? Space.CONSTRAINT_SPACE_LOCAL : Space.CONSTRAINT_SPACE_WORLD;
      Transform transform=constraintHelper.getTransform(boneContext.getArmatureObjectOMA(),boneContext.getBone().getName(),space);
      bonesMatrices.add(new DTransform(transform).toMatrix());
      bone=bone.getParent();
    }
  }
}
