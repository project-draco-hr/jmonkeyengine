{
  int written=0;
  try {
    while (outDataEncrypted.hasRemaining()) {
      written+=channel.write(outDataEncrypted);
    }
  }
 catch (  IOException ioe) {
    outDataEncrypted.position(outDataEncrypted.limit());
    throw ioe;
  }
  log.log(Level.FINE,"[{0}][TCP] Wrote {1} bytes to {2}.",new Object[]{label,written,channel.socket().getRemoteSocketAddress()});
  if (outDataEncrypted.hasRemaining()) {
    SelectionKey key=channel.keyFor(selector);
    key.interestOps(SelectionKey.OP_WRITE);
    return false;
  }
 else {
    return true;
  }
}
