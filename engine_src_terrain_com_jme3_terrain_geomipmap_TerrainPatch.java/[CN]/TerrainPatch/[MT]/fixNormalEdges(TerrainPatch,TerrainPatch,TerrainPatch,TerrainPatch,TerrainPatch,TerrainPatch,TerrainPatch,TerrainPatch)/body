{
  Vector3f rootPoint=new Vector3f();
  Vector3f rightPoint=new Vector3f();
  Vector3f leftPoint=new Vector3f();
  Vector3f topPoint=new Vector3f();
  Vector3f bottomPoint=new Vector3f();
  Vector2f rootTex=new Vector2f();
  Vector2f rightTex=new Vector2f();
  Vector2f leftTex=new Vector2f();
  Vector2f topTex=new Vector2f();
  Vector2f bottomTex=new Vector2f();
  Vector3f normal=new Vector3f();
  Vector3f tangent=new Vector3f();
  int s=this.getSize() - 1;
  if (right != null) {
    for (int i=0; i < s + 1; i++) {
      rootPoint.set(s,this.getHeightmapHeight(s,i),i);
      leftPoint.set(s - 1,this.getHeightmapHeight(s - 1,i),i);
      rightPoint.set(s + 1,right.getHeightmapHeight(1,i),i);
      this.getTex(s,i,rootTex);
      this.getTex(s - 1,i,leftTex);
      right.getTex(1,i,rightTex);
      if (i == 0) {
        if (top == null) {
          bottomPoint.set(s,this.getHeightmapHeight(s,i + 1),i + 1);
          this.getTex(s,i + 1,bottomTex);
          averageNormalsTangents(null,rootPoint,leftPoint,bottomPoint,rightPoint,null,rootTex,leftTex,bottomTex,rightTex,normal,tangent);
          VertexBuffer tpNB=this.getMesh().getBuffer(Type.Normal);
          VertexBuffer tpTB=this.getMesh().getBuffer(Type.Tangent);
          VertexBuffer rightNB=right.getMesh().getBuffer(Type.Normal);
          VertexBuffer rightTB=right.getMesh().getBuffer(Type.Tangent);
          BufferUtils.setInBuffer(normal,(FloatBuffer)tpNB.getData(),s);
          BufferUtils.setInBuffer(tangent,(FloatBuffer)tpTB.getData(),s);
          BufferUtils.setInBuffer(normal,(FloatBuffer)rightNB.getData(),0);
          BufferUtils.setInBuffer(tangent,(FloatBuffer)rightTB.getData(),0);
        }
 else {
          topPoint.set(s,top.getHeightmapHeight(s,s - 1),i - 1);
          bottomPoint.set(s,this.getHeightmapHeight(s,i + 1),i + 1);
          top.getTex(s,s - 1,topTex);
          this.getTex(s,i + 1,bottomTex);
          averageNormalsTangents(topPoint,rootPoint,leftPoint,bottomPoint,rightPoint,topTex,rootTex,leftTex,bottomTex,rightTex,normal,tangent);
          VertexBuffer tpNB=this.getMesh().getBuffer(Type.Normal);
          VertexBuffer tpTB=this.getMesh().getBuffer(Type.Tangent);
          VertexBuffer rightNB=right.getMesh().getBuffer(Type.Normal);
          VertexBuffer rightTB=right.getMesh().getBuffer(Type.Tangent);
          VertexBuffer topNB=top.getMesh().getBuffer(Type.Normal);
          VertexBuffer topTB=top.getMesh().getBuffer(Type.Tangent);
          BufferUtils.setInBuffer(normal,(FloatBuffer)tpNB.getData(),s);
          BufferUtils.setInBuffer(tangent,(FloatBuffer)tpTB.getData(),s);
          BufferUtils.setInBuffer(normal,(FloatBuffer)rightNB.getData(),0);
          BufferUtils.setInBuffer(tangent,(FloatBuffer)rightTB.getData(),0);
          BufferUtils.setInBuffer(normal,(FloatBuffer)topNB.getData(),(s + 1) * (s + 1) - 1);
          BufferUtils.setInBuffer(tangent,(FloatBuffer)topTB.getData(),(s + 1) * (s + 1) - 1);
        }
      }
 else       if (i == s) {
        if (bottom == null) {
          topPoint.set(s,this.getHeightmapHeight(s,i - 1),i - 1);
          this.getTex(s,i - 1,topTex);
          averageNormalsTangents(topPoint,rootPoint,leftPoint,null,rightPoint,topTex,rootTex,leftTex,null,rightTex,normal,tangent);
          VertexBuffer tpNB=this.getMesh().getBuffer(Type.Normal);
          VertexBuffer tpTB=this.getMesh().getBuffer(Type.Tangent);
          VertexBuffer rightNB=right.getMesh().getBuffer(Type.Normal);
          VertexBuffer rightTB=right.getMesh().getBuffer(Type.Tangent);
          BufferUtils.setInBuffer(normal,(FloatBuffer)tpNB.getData(),(s + 1) * (i + 1) - 1);
          BufferUtils.setInBuffer(tangent,(FloatBuffer)tpTB.getData(),(s + 1) * (i + 1) - 1);
          BufferUtils.setInBuffer(normal,(FloatBuffer)rightNB.getData(),(s + 1) * (i));
          BufferUtils.setInBuffer(tangent,(FloatBuffer)rightTB.getData(),(s + 1) * (i));
        }
 else {
          topPoint.set(s,this.getHeightmapHeight(s,i - 1),i - 1);
          bottomPoint.set(s,bottom.getHeightmapHeight(s,1),i + 1);
          this.getTex(s,i - 1,topTex);
          bottom.getTex(s,1,bottomTex);
          averageNormalsTangents(topPoint,rootPoint,leftPoint,bottomPoint,rightPoint,topTex,rootTex,leftTex,bottomTex,rightTex,normal,tangent);
          VertexBuffer tpNB=this.getMesh().getBuffer(Type.Normal);
          VertexBuffer tpTB=this.getMesh().getBuffer(Type.Tangent);
          VertexBuffer rightNB=right.getMesh().getBuffer(Type.Normal);
          VertexBuffer rightTB=right.getMesh().getBuffer(Type.Tangent);
          VertexBuffer downNB=bottom.getMesh().getBuffer(Type.Normal);
          VertexBuffer downTB=bottom.getMesh().getBuffer(Type.Tangent);
          BufferUtils.setInBuffer(normal,(FloatBuffer)tpNB.getData(),(s + 1) * (s + 1) - 1);
          BufferUtils.setInBuffer(tangent,(FloatBuffer)tpTB.getData(),(s + 1) * (s + 1) - 1);
          BufferUtils.setInBuffer(normal,(FloatBuffer)rightNB.getData(),(s + 1) * s);
          BufferUtils.setInBuffer(tangent,(FloatBuffer)rightTB.getData(),(s + 1) * s);
          BufferUtils.setInBuffer(normal,(FloatBuffer)downNB.getData(),s);
          BufferUtils.setInBuffer(tangent,(FloatBuffer)downTB.getData(),s);
          downNB.setUpdateNeeded();
          downTB.setUpdateNeeded();
        }
      }
 else {
        topPoint.set(s,this.getHeightmapHeight(s,i - 1),i - 1);
        bottomPoint.set(s,this.getHeightmapHeight(s,i + 1),i + 1);
        this.getTex(s,i - 1,topTex);
        this.getTex(s,i + 1,bottomTex);
        averageNormalsTangents(topPoint,rootPoint,leftPoint,bottomPoint,rightPoint,topTex,rootTex,leftTex,bottomTex,rightTex,normal,tangent);
        VertexBuffer tpNB=this.getMesh().getBuffer(Type.Normal);
        VertexBuffer tpTB=this.getMesh().getBuffer(Type.Tangent);
        VertexBuffer rightNB=right.getMesh().getBuffer(Type.Normal);
        VertexBuffer rightTB=right.getMesh().getBuffer(Type.Tangent);
        BufferUtils.setInBuffer(normal,(FloatBuffer)tpNB.getData(),(s + 1) * (i + 1) - 1);
        BufferUtils.setInBuffer(tangent,(FloatBuffer)tpTB.getData(),(s + 1) * (i + 1) - 1);
        BufferUtils.setInBuffer(normal,(FloatBuffer)rightNB.getData(),(s + 1) * (i));
        BufferUtils.setInBuffer(tangent,(FloatBuffer)rightTB.getData(),(s + 1) * (i));
      }
    }
    right.getMesh().getBuffer(Type.Normal).setUpdateNeeded();
    right.getMesh().getBuffer(Type.Tangent).setUpdateNeeded();
  }
  if (bottom != null) {
    for (int i=0; i < s + 1; i++) {
      rootPoint.set(i,this.getHeightmapHeight(i,s),s);
      topPoint.set(i,this.getHeightmapHeight(i,s - 1),s - 1);
      bottomPoint.set(i,bottom.getHeightmapHeight(i,1),s + 1);
      this.getTex(i,s,rootTex);
      this.getTex(i,s - 1,topTex);
      bottom.getTex(i,1,bottomTex);
      if (i == 0) {
      }
 else       if (i == s) {
      }
 else {
        leftPoint.set(i - 1,this.getHeightmapHeight(i - 1,s),s);
        rightPoint.set(i + 1,this.getHeightmapHeight(i + 1,s),s);
        this.getTex(i - 1,s,leftTex);
        this.getTex(i + 1,s,rightTex);
        averageNormalsTangents(topPoint,rootPoint,leftPoint,bottomPoint,rightPoint,topTex,rootTex,leftTex,bottomTex,rightTex,normal,tangent);
        VertexBuffer tpNB=this.getMesh().getBuffer(Type.Normal);
        VertexBuffer tpTB=this.getMesh().getBuffer(Type.Tangent);
        VertexBuffer downNB=bottom.getMesh().getBuffer(Type.Normal);
        VertexBuffer downTB=bottom.getMesh().getBuffer(Type.Tangent);
        BufferUtils.setInBuffer(normal,(FloatBuffer)tpNB.getData(),(s + 1) * (s) + i);
        BufferUtils.setInBuffer(tangent,(FloatBuffer)tpTB.getData(),(s + 1) * (s) + i);
        BufferUtils.setInBuffer(normal,(FloatBuffer)downNB.getData(),i);
        BufferUtils.setInBuffer(tangent,(FloatBuffer)downTB.getData(),i);
      }
    }
    bottom.getMesh().getBuffer(Type.Normal).setUpdateNeeded();
    bottom.getMesh().getBuffer(Type.Tangent).setUpdateNeeded();
  }
  if (left != null) {
    for (int i=0; i < s + 1; i++) {
      rootPoint.set(0,this.getHeightmapHeight(0,i),i);
      leftPoint.set(-1,left.getHeightmapHeight(s - 1,i),i);
      rightPoint.set(1,this.getHeightmapHeight(1,i),i);
      this.getTex(0,i,rootTex);
      left.getTex(s - 1,i,leftTex);
      this.getTex(1,i,rightTex);
      if (i == 0) {
        if (top == null) {
          bottomPoint.set(0,this.getHeightmapHeight(0,i + 1),i + 1);
          this.getTex(0,i + 1,bottomTex);
          averageNormalsTangents(null,rootPoint,leftPoint,bottomPoint,rightPoint,null,rootTex,leftTex,bottomTex,rightTex,normal,tangent);
          VertexBuffer tpNB=this.getMesh().getBuffer(Type.Normal);
          VertexBuffer tpTB=this.getMesh().getBuffer(Type.Tangent);
          VertexBuffer leftNB=left.getMesh().getBuffer(Type.Normal);
          VertexBuffer leftTB=left.getMesh().getBuffer(Type.Tangent);
          BufferUtils.setInBuffer(normal,(FloatBuffer)tpNB.getData(),0);
          BufferUtils.setInBuffer(tangent,(FloatBuffer)tpTB.getData(),0);
          BufferUtils.setInBuffer(normal,(FloatBuffer)leftNB.getData(),s + 1);
          BufferUtils.setInBuffer(tangent,(FloatBuffer)leftTB.getData(),s + 1);
        }
 else {
          topPoint.set(0,top.getHeightmapHeight(0,s - 1),i - 1);
          bottomPoint.set(0,this.getHeightmapHeight(0,i + 1),i + 1);
          top.getTex(0,i - 1,topTex);
          this.getTex(0,i + 1,bottomTex);
          averageNormalsTangents(topPoint,rootPoint,leftPoint,bottomPoint,rightPoint,topTex,rootTex,leftTex,bottomTex,rightTex,normal,tangent);
          VertexBuffer tpNB=this.getMesh().getBuffer(Type.Normal);
          VertexBuffer tpTB=this.getMesh().getBuffer(Type.Tangent);
          VertexBuffer leftNB=left.getMesh().getBuffer(Type.Normal);
          VertexBuffer leftTB=left.getMesh().getBuffer(Type.Tangent);
          VertexBuffer topNB=top.getMesh().getBuffer(Type.Normal);
          VertexBuffer topTB=top.getMesh().getBuffer(Type.Tangent);
          BufferUtils.setInBuffer(normal,(FloatBuffer)tpNB.getData(),0);
          BufferUtils.setInBuffer(tangent,(FloatBuffer)tpTB.getData(),0);
          BufferUtils.setInBuffer(normal,(FloatBuffer)leftNB.getData(),s);
          BufferUtils.setInBuffer(tangent,(FloatBuffer)leftTB.getData(),s);
          BufferUtils.setInBuffer(normal,(FloatBuffer)topNB.getData(),(s + 1) * s);
          BufferUtils.setInBuffer(tangent,(FloatBuffer)topTB.getData(),(s + 1) * s);
          topNB.setUpdateNeeded();
        }
      }
 else       if (i == s) {
      }
 else {
        topPoint.set(0,this.getHeightmapHeight(0,i - 1),i - 1);
        bottomPoint.set(0,this.getHeightmapHeight(0,i + 1),i + 1);
        this.getTex(0,i - 1,topTex);
        this.getTex(0,i + 1,bottomTex);
        averageNormalsTangents(topPoint,rootPoint,leftPoint,bottomPoint,rightPoint,topTex,rootTex,leftTex,bottomTex,rightTex,normal,tangent);
        VertexBuffer tpNB=this.getMesh().getBuffer(Type.Normal);
        VertexBuffer tpTB=this.getMesh().getBuffer(Type.Tangent);
        VertexBuffer leftNB=left.getMesh().getBuffer(Type.Normal);
        VertexBuffer leftTB=left.getMesh().getBuffer(Type.Tangent);
        BufferUtils.setInBuffer(normal,(FloatBuffer)tpNB.getData(),(s + 1) * (i));
        BufferUtils.setInBuffer(tangent,(FloatBuffer)tpTB.getData(),(s + 1) * (i));
        BufferUtils.setInBuffer(normal,(FloatBuffer)leftNB.getData(),(s + 1) * (i + 1) - 1);
        BufferUtils.setInBuffer(tangent,(FloatBuffer)leftTB.getData(),(s + 1) * (i + 1) - 1);
      }
    }
    left.getMesh().getBuffer(Type.Normal).setUpdateNeeded();
    left.getMesh().getBuffer(Type.Tangent).setUpdateNeeded();
  }
  if (top != null) {
    for (int i=0; i < s + 1; i++) {
      rootPoint.set(i,this.getHeightmapHeight(i,0),0);
      topPoint.set(i,top.getHeightmapHeight(i,s - 1),-1);
      bottomPoint.set(i,this.getHeightmapHeight(i,1),1);
      this.getTex(i,s,rootTex);
      top.getTex(i,s - 1,topTex);
      this.getTex(i,1,bottomTex);
      if (i == 0) {
      }
 else       if (i == s) {
      }
 else {
        leftPoint.set(i - 1,this.getHeightmapHeight(i - 1,0),0);
        rightPoint.set(i + 1,this.getHeightmapHeight(i + 1,0),0);
        this.getTex(i - 1,0,leftTex);
        this.getTex(i + 1,0,rightTex);
        averageNormalsTangents(topPoint,rootPoint,leftPoint,bottomPoint,rightPoint,topTex,rootTex,leftTex,bottomTex,rightTex,normal,tangent);
        VertexBuffer tpNB=this.getMesh().getBuffer(Type.Normal);
        VertexBuffer tpTB=this.getMesh().getBuffer(Type.Tangent);
        VertexBuffer topNB=top.getMesh().getBuffer(Type.Normal);
        VertexBuffer topTB=top.getMesh().getBuffer(Type.Tangent);
        BufferUtils.setInBuffer(normal,(FloatBuffer)tpNB.getData(),i);
        BufferUtils.setInBuffer(tangent,(FloatBuffer)tpTB.getData(),i);
        BufferUtils.setInBuffer(normal,(FloatBuffer)topNB.getData(),(s + 1) * (s) + i);
        BufferUtils.setInBuffer(tangent,(FloatBuffer)topTB.getData(),(s + 1) * (s) + i);
      }
    }
    top.getMesh().getBuffer(Type.Normal).setUpdateNeeded();
  }
  this.getMesh().getBuffer(Type.Normal).setUpdateNeeded();
  this.getMesh().getBuffer(Type.Tangent).setUpdateNeeded();
}
