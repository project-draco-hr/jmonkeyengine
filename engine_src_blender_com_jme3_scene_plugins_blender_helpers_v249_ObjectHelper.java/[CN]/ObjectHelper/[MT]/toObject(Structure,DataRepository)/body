{
  Object loadedResult=dataRepository.getLoadedFeature(objectStructure.getOldMemoryAddress(),LoadedFeatureDataType.LOADED_FEATURE);
  if (loadedResult != null) {
    return loadedResult;
  }
  dataRepository.pushParent(objectStructure);
  ObjectHelper objectHelper=dataRepository.getHelper(ObjectHelper.class);
  ModifierHelper modifierHelper=dataRepository.getHelper(ModifierHelper.class);
  ArmatureHelper armatureHelper=dataRepository.getHelper(ArmatureHelper.class);
  ConstraintHelper constraintHelper=dataRepository.getHelper(ConstraintHelper.class);
  int type=((Number)objectStructure.getFieldValue("type")).intValue();
  String name=objectStructure.getName();
  LOGGER.log(Level.INFO,"Loading obejct: {0}",name);
  modifierHelper.readModifiers(objectStructure,dataRepository);
  Modifier objectAnimationModifier=objectHelper.readObjectAnimation(objectStructure,dataRepository);
  constraintHelper.loadConstraints(objectStructure,dataRepository);
  int restrictflag=((Number)objectStructure.getFieldValue("restrictflag")).intValue();
  boolean visible=(restrictflag & 0x01) != 0;
  Object result=null;
  Pointer pParent=(Pointer)objectStructure.getFieldValue("parent");
  Object parent=dataRepository.getLoadedFeature(pParent.getOldMemoryAddress(),LoadedFeatureDataType.LOADED_FEATURE);
  if (parent == null && !pParent.isNull()) {
    Structure parentStructure=pParent.fetchData(dataRepository.getInputStream()).get(0);
    parent=this.toObject(parentStructure,dataRepository);
  }
  Transform t=objectHelper.getTransformation(objectStructure);
  try {
switch (type) {
case OBJECT_TYPE_EMPTY:
      LOGGER.log(Level.INFO,"Importing empty.");
    Node empty=new Node(name);
  empty.setLocalTransform(t);
result=empty;
break;
case OBJECT_TYPE_MESH:
LOGGER.log(Level.INFO,"Importing mesh.");
Node node=new Node(name);
node.setCullHint(visible ? CullHint.Always : CullHint.Inherit);
MeshHelper meshHelper=dataRepository.getHelper(MeshHelper.class);
Pointer pMesh=(Pointer)objectStructure.getFieldValue("data");
List<Structure> meshesArray=pMesh.fetchData(dataRepository.getInputStream());
List<Geometry> geometries=meshHelper.toMesh(meshesArray.get(0),dataRepository);
for (Geometry geometry : geometries) {
node.attachChild(geometry);
}
node.setLocalTransform(t);
List<Modifier> modifiers=dataRepository.getModifiers(objectStructure.getOldMemoryAddress(),null);
for (Modifier modifier : modifiers) {
modifierHelper.applyModifier(node,modifier,dataRepository);
}
if (objectAnimationModifier != null) {
node=modifierHelper.applyModifier(node,objectAnimationModifier,dataRepository);
}
if (parent instanceof Node) {
((Node)parent).attachChild(node);
}
node.updateModelBound();
result=node;
break;
case OBJECT_TYPE_SURF:
case OBJECT_TYPE_CURVE:
LOGGER.log(Level.INFO,"Importing curve/nurb.");
Pointer pCurve=(Pointer)objectStructure.getFieldValue("data");
if (!pCurve.isNull()) {
CurvesHelper curvesHelper=dataRepository.getHelper(CurvesHelper.class);
Structure curveData=pCurve.fetchData(dataRepository.getInputStream()).get(0);
List<Geometry> curves=curvesHelper.toCurve(curveData,dataRepository);
result=new Node(name);
for (Geometry curve : curves) {
((Node)result).attachChild(curve);
}
((Node)result).setLocalTransform(t);
}
break;
case OBJECT_TYPE_LAMP:
LOGGER.log(Level.INFO,"Importing lamp.");
Pointer pLamp=(Pointer)objectStructure.getFieldValue("data");
if (!pLamp.isNull()) {
LightHelper lightHelper=dataRepository.getHelper(LightHelper.class);
List<Structure> lampsArray=pLamp.fetchData(dataRepository.getInputStream());
Light light=lightHelper.toLight(lampsArray.get(0),dataRepository);
if (light != null) {
light.setName(name);
}
if (light instanceof PointLight) {
((PointLight)light).setPosition(t.getTranslation());
}
 else if (light instanceof DirectionalLight) {
Quaternion quaternion=t.getRotation();
Vector3f[] axes=new Vector3f[3];
quaternion.toAxes(axes);
((DirectionalLight)light).setDirection(axes[2].negate());
}
 else {
LOGGER.log(Level.WARNING,"Unknown type of light: {0}",light);
}
result=light;
}
break;
case OBJECT_TYPE_CAMERA:
Pointer pCamera=(Pointer)objectStructure.getFieldValue("data");
if (!pCamera.isNull()) {
CameraHelper cameraHelper=dataRepository.getHelper(CameraHelper.class);
List<Structure> camerasArray=pCamera.fetchData(dataRepository.getInputStream());
Camera camera=cameraHelper.toCamera(camerasArray.get(0));
camera.setLocation(t.getTranslation());
camera.setRotation(t.getRotation());
result=camera;
}
break;
case OBJECT_TYPE_ARMATURE:
LOGGER.log(Level.INFO,"Importing armature.");
Pointer pArmature=(Pointer)objectStructure.getFieldValue("data");
List<Structure> armaturesArray=pArmature.fetchData(dataRepository.getInputStream());
result=armatureHelper.toArmature(armaturesArray.get(0),dataRepository);
break;
default :
LOGGER.log(Level.WARNING,"Unknown object type: {0}",type);
}
}
  finally {
dataRepository.popParent();
}
Properties properties=this.loadProperties(objectStructure,dataRepository);
if (properties != null && properties.getValue() != null) {
((Node)result).setUserData("properties",properties);
}
if (result != null) {
dataRepository.addLoadedFeatures(objectStructure.getOldMemoryAddress(),name,objectStructure,result);
}
return result;
}
