{
  ModelKey modelKey=(ModelKey)assetInfo.getKey();
  BlenderKey blenderKey;
  if (modelKey instanceof BlenderKey) {
    blenderKey=(BlenderKey)modelKey;
  }
 else {
    blenderKey=new BlenderKey(modelKey.getName());
    blenderKey.setAssetRootPath(modelKey.getFolder());
  }
  BlenderInputStream inputStream=new BlenderInputStream(assetInfo.openStream(),assetInfo.getManager());
  blocks=new ArrayList<FileBlockHeader>();
  FileBlockHeader fileBlock;
  blenderContext=new BlenderContext();
  blenderContext.setAssetManager(assetInfo.getManager());
  blenderContext.setInputStream(inputStream);
  blenderContext.setBlenderKey(blenderKey);
  blenderContext.putHelper(ArmatureHelper.class,new ArmatureHelper(inputStream.getVersionNumber()));
  blenderContext.putHelper(TextureHelper.class,new TextureHelper(inputStream.getVersionNumber()));
  blenderContext.putHelper(MeshHelper.class,new MeshHelper(inputStream.getVersionNumber()));
  blenderContext.putHelper(ObjectHelper.class,new ObjectHelper(inputStream.getVersionNumber()));
  blenderContext.putHelper(CurvesHelper.class,new CurvesHelper(inputStream.getVersionNumber()));
  blenderContext.putHelper(LightHelper.class,new LightHelper(inputStream.getVersionNumber()));
  blenderContext.putHelper(CameraHelper.class,new CameraHelper(inputStream.getVersionNumber()));
  blenderContext.putHelper(ModifierHelper.class,new ModifierHelper(inputStream.getVersionNumber()));
  blenderContext.putHelper(MaterialHelper.class,new MaterialHelper(inputStream.getVersionNumber()));
  blenderContext.putHelper(ConstraintHelper.class,new ConstraintHelper(inputStream.getVersionNumber(),blenderContext));
  blenderContext.putHelper(IpoHelper.class,new IpoHelper(inputStream.getVersionNumber()));
  blenderContext.putHelper(ParticlesHelper.class,new ParticlesHelper(inputStream.getVersionNumber()));
  if (blenderKey.isFixUpAxis()) {
    AbstractBlenderHelper helper=blenderContext.getHelper(ObjectHelper.class);
    helper.setyIsUpAxis(true);
    helper=blenderContext.getHelper(CurvesHelper.class);
    helper.setyIsUpAxis(true);
    helper=blenderContext.getHelper(ArmatureHelper.class);
    helper.setyIsUpAxis(true);
    helper=blenderContext.getHelper(MeshHelper.class);
    helper.setyIsUpAxis(true);
  }
  MaterialHelper materialHelper=blenderContext.getHelper(MaterialHelper.class);
  materialHelper.setFaceCullMode(blenderKey.getFaceCullMode());
  FileBlockHeader sceneFileBlock=null;
  do {
    fileBlock=new FileBlockHeader(inputStream,blenderContext);
    if (!fileBlock.isDnaBlock()) {
      blocks.add(fileBlock);
      if (fileBlock.getCode() == FileBlockHeader.BLOCK_SC00 && blenderKey.getLayersToLoad() < 0) {
        sceneFileBlock=fileBlock;
      }
    }
  }
 while (!fileBlock.isLastBlock());
  if (sceneFileBlock != null) {
    int lay=((Number)sceneFileBlock.getStructure(blenderContext).getFieldValue("lay")).intValue();
    blenderContext.getBlenderKey().setLayersToLoad(lay);
  }
}
