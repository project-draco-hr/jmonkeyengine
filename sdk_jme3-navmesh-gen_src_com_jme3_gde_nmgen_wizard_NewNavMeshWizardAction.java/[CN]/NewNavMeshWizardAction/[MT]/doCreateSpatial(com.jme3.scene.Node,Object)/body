{
  if (configuration == null) {
    return null;
  }
  ProgressHandle progressHandle=ProgressHandleFactory.createHandle("Generating NavMesh");
  progressHandle.start();
  final Geometry navMesh=new Geometry("NavMesh");
  try {
    WizardDescriptor wizardDescriptor=(WizardDescriptor)configuration;
    NavMeshGenerator generator=(NavMeshGenerator)wizardDescriptor.getProperty("generator");
    IntermediateData id=new IntermediateData();
    generator.setIntermediateData(null);
    Mesh mesh=new Mesh();
    GeometryBatchFactory.mergeGeometries(findGeometries(rootNode,new LinkedList<Geometry>(),generator,rootNode),mesh);
    Mesh optiMesh=generator.optimize(mesh);
    if (optiMesh == null)     return null;
    Material material=new Material(pm,"Common/MatDefs/Misc/Unshaded.j3md");
    material.getAdditionalRenderState().setWireframe(true);
    material.setColor("Color",ColorRGBA.Green);
    navMesh.setMaterial(material);
    navMesh.setMesh(optiMesh);
    navMesh.setCullHint(CullHint.Always);
    navMesh.setModelBound(new BoundingBox());
  }
  finally {
    progressHandle.finish();
  }
  return navMesh;
}
