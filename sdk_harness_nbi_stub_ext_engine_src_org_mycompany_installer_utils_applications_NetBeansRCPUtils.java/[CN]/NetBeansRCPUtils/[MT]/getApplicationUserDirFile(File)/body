{
  String dir=getApplicationUserDir(appLocation);
  String userHome=System.getProperty("user.home");
  if (SystemUtils.isWindows()) {
    WindowsNativeUtils wnu=(WindowsNativeUtils)SystemUtils.getNativeUtils();
    WindowsRegistry reg=wnu.getWindowsRegistry();
    String key="Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders";
    try {
      if (reg.keyExists(reg.HKCU,key) && reg.valueExists(reg.HKCU,key,"AppData")) {
        userHome=reg.getStringValue(reg.HKCU,key,"AppData",false);
      }
    }
 catch (    NativeException e) {
      LogManager.log(e);
    }
  }
  dir=dir.replace(USER_HOME_TOKEN,userHome);
  dir=dir.replace(APPNAME_TOKEN,getApplicationName(appLocation));
  return new File(dir);
}
