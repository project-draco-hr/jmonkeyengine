{
  if (numLights == 0) {
    return;
  }
  LightList lightList=g.getWorldLightList();
  Uniform lightColor=shader.getUniform("g_LightColor");
  Uniform lightPos=shader.getUniform("g_LightPosition");
  lightColor.setVector4Length(numLights);
  lightPos.setVector4Length(numLights);
  Uniform ambientColor=shader.getUniform("g_AmbientLightColor");
  ambientColor.setValue(VarType.Vector4,getAmbientColor(lightList));
  int lightIndex=0;
  for (int i=0; i < numLights; i++) {
    if (lightList.size() <= i) {
      lightColor.setVector4InArray(0f,0f,0f,0f,lightIndex);
      lightPos.setVector4InArray(0f,0f,0f,0f,lightIndex);
    }
 else {
      Light l=lightList.get(i);
      ColorRGBA color=l.getColor();
      lightColor.setVector4InArray(color.getRed(),color.getGreen(),color.getBlue(),l.getType().getId(),i);
switch (l.getType()) {
case Directional:
        DirectionalLight dl=(DirectionalLight)l;
      Vector3f dir=dl.getDirection();
    lightPos.setVector4InArray(dir.getX(),dir.getY(),dir.getZ(),-1,lightIndex);
  break;
case Point:
PointLight pl=(PointLight)l;
Vector3f pos=pl.getPosition();
float invRadius=pl.getRadius();
if (invRadius != 0) {
invRadius=1f / invRadius;
}
lightPos.setVector4InArray(pos.getX(),pos.getY(),pos.getZ(),invRadius,lightIndex);
break;
case Ambient:
continue;
default :
throw new UnsupportedOperationException("Unknown type of light: " + l.getType());
}
}
lightIndex++;
}
while (lightIndex < numLights) {
lightColor.setVector4InArray(0f,0f,0f,0f,lightIndex);
lightPos.setVector4InArray(0f,0f,0f,0f,lightIndex);
lightIndex++;
}
}
