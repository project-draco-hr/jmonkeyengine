{
  Object loadedResult=blenderContext.getLoadedFeature(objectStructure.getOldMemoryAddress(),LoadedFeatureDataType.LOADED_FEATURE);
  if (loadedResult != null) {
    return loadedResult;
  }
  blenderContext.pushParent(objectStructure);
  int type=((Number)objectStructure.getFieldValue("type")).intValue();
  String name=objectStructure.getName();
  LOGGER.log(Level.FINE,"Loading obejct: {0}",name);
  int restrictflag=((Number)objectStructure.getFieldValue("restrictflag")).intValue();
  boolean visible=(restrictflag & 0x01) != 0;
  Node result=null;
  Pointer pParent=(Pointer)objectStructure.getFieldValue("parent");
  Object parent=blenderContext.getLoadedFeature(pParent.getOldMemoryAddress(),LoadedFeatureDataType.LOADED_FEATURE);
  if (parent == null && pParent.isNotNull()) {
    Structure parentStructure=pParent.fetchData(blenderContext.getInputStream()).get(0);
    parent=this.toObject(parentStructure,blenderContext);
  }
  Transform t=this.getTransformation(objectStructure,blenderContext);
  try {
switch (type) {
case OBJECT_TYPE_EMPTY:
      LOGGER.log(Level.FINE,"Importing empty.");
    Node empty=new Node(name);
  empty.setLocalTransform(t);
if (parent instanceof Node) {
  ((Node)parent).attachChild(empty);
}
result=empty;
break;
case OBJECT_TYPE_MESH:
LOGGER.log(Level.FINE,"Importing mesh.");
Node node=new Node(name);
node.setCullHint(visible ? CullHint.Always : CullHint.Inherit);
MeshHelper meshHelper=blenderContext.getHelper(MeshHelper.class);
Pointer pMesh=(Pointer)objectStructure.getFieldValue("data");
List<Structure> meshesArray=pMesh.fetchData(blenderContext.getInputStream());
List<Geometry> geometries=meshHelper.toMesh(meshesArray.get(0),blenderContext);
if (geometries != null) {
for (Geometry geometry : geometries) {
node.attachChild(geometry);
}
}
node.setLocalTransform(t);
if (parent instanceof Node) {
((Node)parent).attachChild(node);
}
result=node;
break;
case OBJECT_TYPE_SURF:
case OBJECT_TYPE_CURVE:
LOGGER.log(Level.FINE,"Importing curve/nurb.");
Pointer pCurve=(Pointer)objectStructure.getFieldValue("data");
if (pCurve.isNotNull()) {
CurvesHelper curvesHelper=blenderContext.getHelper(CurvesHelper.class);
Structure curveData=pCurve.fetchData(blenderContext.getInputStream()).get(0);
List<Geometry> curves=curvesHelper.toCurve(curveData,blenderContext);
result=new Node(name);
for (Geometry curve : curves) {
result.attachChild(curve);
}
result.setLocalTransform(t);
}
break;
case OBJECT_TYPE_LAMP:
LOGGER.log(Level.FINE,"Importing lamp.");
Pointer pLamp=(Pointer)objectStructure.getFieldValue("data");
if (pLamp.isNotNull()) {
LightHelper lightHelper=blenderContext.getHelper(LightHelper.class);
List<Structure> lampsArray=pLamp.fetchData(blenderContext.getInputStream());
LightNode light=lightHelper.toLight(lampsArray.get(0),blenderContext);
if (light != null) {
light.setName(name);
light.setLocalTransform(t);
}
result=light;
}
break;
case OBJECT_TYPE_CAMERA:
Pointer pCamera=(Pointer)objectStructure.getFieldValue("data");
if (pCamera.isNotNull()) {
CameraHelper cameraHelper=blenderContext.getHelper(CameraHelper.class);
List<Structure> camerasArray=pCamera.fetchData(blenderContext.getInputStream());
CameraNode camera=cameraHelper.toCamera(camerasArray.get(0),blenderContext);
camera.setName(name);
camera.setLocalTransform(t);
result=camera;
}
break;
case OBJECT_TYPE_ARMATURE:
Node armature=new Node(name);
armature.setLocalTransform(t);
armature.setUserData(ArmatureHelper.ARMETURE_NODE_MARKER,Boolean.TRUE);
if (parent instanceof Node) {
((Node)parent).attachChild(armature);
}
result=armature;
break;
default :
LOGGER.log(Level.WARNING,"Unknown object type: {0}",type);
}
}
  finally {
blenderContext.popParent();
}
if (result != null) {
result.updateModelBound();
blenderContext.addLoadedFeatures(objectStructure.getOldMemoryAddress(),name,objectStructure,result);
LOGGER.log(Level.FINE,"Reading and applying object's modifiers.");
ModifierHelper modifierHelper=blenderContext.getHelper(ModifierHelper.class);
Collection<Modifier> modifiers=modifierHelper.readModifiers(objectStructure,blenderContext);
for (Modifier modifier : modifiers) {
modifier.apply(result,blenderContext);
}
ConstraintHelper constraintHelper=blenderContext.getHelper(ConstraintHelper.class);
constraintHelper.loadConstraints(objectStructure,blenderContext);
if (blenderContext.getBlenderKey().isLoadObjectProperties()) {
Properties properties=this.loadProperties(objectStructure,blenderContext);
if (result instanceof Spatial && properties != null && properties.getValue() != null) {
this.applyProperties(result,properties);
}
}
}
return result;
}
