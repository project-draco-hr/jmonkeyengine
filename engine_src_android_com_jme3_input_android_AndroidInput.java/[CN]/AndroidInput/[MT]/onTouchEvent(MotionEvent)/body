{
  boolean bWasHandled=false;
  MouseButtonEvent btn;
  TouchEvent touch;
  processEvent(event);
  this.detector.onTouchEvent(event);
  this.scaledetector.onTouchEvent(event);
  int newX=getWidth() - (int)event.getX();
  int newY=(int)event.getY();
switch (event.getAction()) {
case MotionEvent.ACTION_DOWN:
    if (FIRE_MOUSE_EVENTS) {
      btn=new MouseButtonEvent(0,true,newX,newY);
      btn.setTime(event.getEventTime());
      processEvent(btn);
    }
  lastX=-1;
lastY=-1;
touch=new TouchEvent(TouchEvent.Type.GRABBED,TouchEvent.Operation.NOP,event.getX(),event.getY(),0,0,null);
processEvent(touch);
bWasHandled=true;
break;
case MotionEvent.ACTION_UP:
if (FIRE_MOUSE_EVENTS) {
btn=new MouseButtonEvent(0,false,newX,newY);
btn.setTime(event.getEventTime());
processEvent(btn);
}
lastX=-1;
lastY=-1;
if (dragging) {
touch=new TouchEvent(TouchEvent.Type.DRAGGED,TouchEvent.Operation.STOPPED,event.getX(),event.getY(),event.getX() - lastX,event.getY() - lastY,null);
processEvent(touch);
}
touch=new TouchEvent(TouchEvent.Type.RELEASED,TouchEvent.Operation.NOP,event.getX(),event.getY(),0,0,null);
processEvent(touch);
dragging=false;
bWasHandled=true;
break;
case MotionEvent.ACTION_MOVE:
if (!scaledetector.isInProgress()) {
if (!dragging) touch=new TouchEvent(TouchEvent.Type.DRAGGED,TouchEvent.Operation.STARTED,event.getX(),event.getY(),event.getX() - lastX,event.getY() - lastY,null);
 else touch=new TouchEvent(TouchEvent.Type.DRAGGED,TouchEvent.Operation.RUNNING,event.getX(),event.getY(),event.getX() - lastX,event.getY() - lastY,null);
processEvent(touch);
dragging=true;
}
if (FIRE_MOUSE_EVENTS) {
int dx;
int dy;
if (lastX != -1) {
dx=newX - lastX;
dy=newY - lastY;
}
 else {
dx=0;
dy=0;
}
MouseMotionEvent mot=new MouseMotionEvent(newX,newY,dx,dy,0,0);
mot.setTime(event.getEventTime());
processEvent(mot);
}
lastX=newX;
lastY=newY;
bWasHandled=true;
break;
case MotionEvent.ACTION_POINTER_UP:
break;
case MotionEvent.ACTION_POINTER_DOWN:
break;
case MotionEvent.ACTION_OUTSIDE:
break;
case MotionEvent.ACTION_CANCEL:
break;
}
return bWasHandled;
}
