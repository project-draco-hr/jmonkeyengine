{
  for (  Service service : services) {
    if (service.getClass() == cls)     return (T)service;
  }
  try {
    if (!Service.class.isAssignableFrom(cls))     return null;
    Constructor ctor;
    if (client) {
      try {
        ctor=cls.getConstructor(new Class[]{Client.class});
      }
 catch (      NoSuchMethodException nsme) {
        log.log(Level.WARNING,"[ServiceManager][???] The service {0} does not support client mode.",cls);
        return null;
      }
    }
 else {
      try {
        ctor=cls.getConstructor(new Class[]{Server.class});
      }
 catch (      NoSuchMethodException nsme) {
        log.log(Level.WARNING,"[ServiceManager][???] The service {0} does not support server mode.",cls);
        return null;
      }
    }
    T inst=(T)ctor.newInstance(this);
    services.add((Service)inst);
    return inst;
  }
 catch (  Exception e) {
    log.log(Level.SEVERE,"[ServiceManager][???] Instantiaton of service failed.",e);
  }
  return null;
}
