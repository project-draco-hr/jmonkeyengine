{
  if (!scene.checkCulling(vp.getCamera())) {
    if (scene.getShadowMode() != RenderQueue.ShadowMode.Off || scene instanceof Node) {
      renderShadow(scene,vp.getQueue());
    }
    return;
  }
  scene.runControlRender(this,vp);
  if (scene instanceof Node) {
    Node n=(Node)scene;
    List<Spatial> children=n.getChildren();
    for (int i=0; i < children.size(); i++) {
      renderScene(children.get(i),vp);
    }
  }
 else   if (scene instanceof Geometry) {
    Geometry gm=(Geometry)scene;
    if (gm.getMaterial() == null) {
      throw new IllegalStateException("No material is set for Geometry: " + gm.getName());
    }
    vp.getQueue().addToQueue(gm,scene.getQueueBucket());
    RenderQueue.ShadowMode shadowMode=scene.getShadowMode();
    if (shadowMode != RenderQueue.ShadowMode.Off) {
      vp.getQueue().addToShadowQueue(gm,shadowMode);
    }
  }
}
