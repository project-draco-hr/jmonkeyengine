{
  if (mode == Mode.Manual) {
    throw new IllegalStateException("Not allowed in manual mode");
  }
  if (maxNumInstances < 1) {
    throw new IllegalArgumentException("maxNumInstances must be 1 or higher");
  }
  this.worldMatrices=new Matrix4f[maxNumInstances];
  if (currentNumInstances > maxNumInstances) {
    currentNumInstances=maxNumInstances;
  }
  for (  VertexBuffer instanceDataVB : instanceDataPerCam.values()) {
    FloatBuffer instanceData=(FloatBuffer)instanceDataVB.getData();
    if (instanceData.capacity() / INSTANCE_SIZE != worldMatrices.length) {
      BufferUtils.destroyDirectBuffer(instanceData);
      instanceData=BufferUtils.createFloatBuffer(worldMatrices.length * INSTANCE_SIZE);
      instanceDataVB.updateData(instanceData);
    }
  }
}
