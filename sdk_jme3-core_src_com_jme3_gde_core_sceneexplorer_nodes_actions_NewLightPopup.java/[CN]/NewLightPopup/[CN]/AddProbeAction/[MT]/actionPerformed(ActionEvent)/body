{
  SceneApplication.getApplication().enqueue(new Callable<Void>(){
    @Override public Void call() throws Exception {
      EnvironmentCamera envCam=SceneApplication.getApplication().getStateManager().getState(EnvironmentCamera.class);
      SceneToolController toolController=SceneApplication.getApplication().getStateManager().getState(SceneToolController.class);
      if (toolController != null) {
        envCam.setPosition(toolController.getCursorLocation());
      }
 else {
        envCam.setPosition(new Vector3f(0,0,0));
      }
      LightProbe lightProbe=LightProbeFactory.makeProbe(envCam,node,new JobProgressAdapter<LightProbe>(){
        int lastProgress;
        ProgressHandle handle=ProgressHandleFactory.createHandle("Generating environment maps");
        @Override public void start(){
          handle.start(100);
        }
        @Override public void progress(        double value){
          lastProgress=(int)(value * 100);
          handle.progress(lastProgress);
        }
        @Override public void step(        String message){
          handle.progress(message,lastProgress);
        }
        @Override public void done(        LightProbe t){
          handle.finish();
        }
      }
);
      node.addLight(lightProbe);
      ((BoundingSphere)lightProbe.getBounds()).setRadius(10);
      addLightUndo(node,lightProbe);
      setModified();
      return null;
    }
  }
);
}
