{
  if (currentPreviewRequest != null) {
    cpuBuf.clear();
    SceneApplication.getApplication().getRenderer().readFrameBuffer(offBuffer,cpuBuf);
    cpuBuf.clear();
    cpuBuf.get(cpuArray);
    cpuBuf.clear();
    for (int i=0; i < width * height * 4; i+=4) {
      byte b=cpuArray[i + 0];
      byte g=cpuArray[i + 1];
      byte r=cpuArray[i + 2];
      byte a=cpuArray[i + 3];
      cpuArray[i + 0]=a;
      cpuArray[i + 1]=b;
      cpuArray[i + 2]=g;
      cpuArray[i + 3]=r;
    }
    BufferedImage image=new BufferedImage(width,height,BufferedImage.TYPE_4BYTE_ABGR);
    WritableRaster wr=image.getRaster();
    DataBufferByte db=(DataBufferByte)wr.getDataBuffer();
    System.arraycopy(cpuArray,0,db.getData(),0,cpuArray.length);
    currentPreviewRequest.setImage(image);
    previewNode.detachAllChildren();
    SceneApplication.getApplication().notifySceneListeners(currentPreviewRequest);
    currentPreviewRequest=null;
  }
}
