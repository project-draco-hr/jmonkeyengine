{
  this.assetManager=assetManager;
  this.postshadowMat=new Material(assetManager,"Common/MatDefs/Shadow/PostShadow.j3md");
  this.nbShadowMaps=nbShadowMaps;
  this.shadowMapSize=shadowMapSize;
  shadowFB=new FrameBuffer[nbShadowMaps];
  shadowMaps=new Texture2D[nbShadowMaps];
  dispPic=new Picture[nbShadowMaps];
  lightViewProjectionsMatrices=new Matrix4f[nbShadowMaps];
  dummyTex=new Texture2D(shadowMapSize,shadowMapSize,Format.RGBA8);
  preshadowMat=new Material(assetManager,"Common/MatDefs/Shadow/PreShadow.j3md");
  postshadowMat.setFloat("ShadowMapSize",shadowMapSize);
  for (int i=0; i < nbShadowMaps; i++) {
    lightViewProjectionsMatrices[i]=new Matrix4f();
    shadowFB[i]=new FrameBuffer(shadowMapSize,shadowMapSize,1);
    shadowMaps[i]=new Texture2D(shadowMapSize,shadowMapSize,Format.Depth);
    shadowFB[i].setDepthTexture(shadowMaps[i]);
    shadowFB[i].setColorTexture(dummyTex);
    postshadowMat.setTexture("ShadowMap" + i,shadowMaps[i]);
    dispPic[i]=new Picture("Picture" + i);
    dispPic[i].setTexture(assetManager,shadowMaps[i],false);
  }
  setShadowCompareMode(CompareMode.Hardware);
  setEdgeFilteringMode(EdgeFilteringMode.Bilinear);
  setShadowIntensity(0.7f);
}
