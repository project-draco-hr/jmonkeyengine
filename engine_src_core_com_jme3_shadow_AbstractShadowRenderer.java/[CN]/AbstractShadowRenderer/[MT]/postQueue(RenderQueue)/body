{
  GeometryList occluders=rq.getShadowQueueContent(ShadowMode.Cast);
  GeometryList receivers=rq.getShadowQueueContent(ShadowMode.Receive);
  if (receivers.size() == 0 || occluders.size() == 0) {
    return;
  }
  updateShadowCams(viewPort.getCamera());
  Renderer r=renderManager.getRenderer();
  renderManager.setForcedMaterial(preshadowMat);
  renderManager.setForcedTechnique("PreShadow");
  for (int shadowMapIndex=0; shadowMapIndex < nbShadowMaps; shadowMapIndex++) {
    if (debugfrustums) {
      doDisplayFrustumDebug(shadowMapIndex);
    }
    renderShadowMap(shadowMapIndex,occluders,receivers);
  }
  debugfrustums=false;
  if (flushQueues) {
    occluders.clear();
  }
  r.setFrameBuffer(viewPort.getOutputFrameBuffer());
  renderManager.setForcedMaterial(null);
  renderManager.setForcedTechnique(null);
  renderManager.setCamera(viewPort.getCamera(),false);
}
