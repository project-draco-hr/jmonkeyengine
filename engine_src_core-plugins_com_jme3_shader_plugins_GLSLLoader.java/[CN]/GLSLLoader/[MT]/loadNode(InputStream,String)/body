{
  DependencyNode node=new DependencyNode(nodeName);
  if (in == null)   throw new IOException("Dependency " + nodeName + " cannot be found.");
  StringBuilder sb=new StringBuilder();
  BufferedReader r=new BufferedReader(new InputStreamReader(in));
  while (r.ready()) {
    String ln=r.readLine();
    if (ln.startsWith("#import ")) {
      ln=ln.substring(8).trim();
      if (ln.startsWith("\"") && ln.endsWith("\"") && ln.length() > 3) {
        ln=ln.substring(1,ln.length() - 1);
        if (ln.equals(nodeName))         throw new IOException("Node depends on itself.");
        DependencyNode dependNode=dependCache.get(ln);
        if (dependNode == null) {
          GlslDependKey key=new GlslDependKey(ln);
          InputStream stream=(InputStream)owner.loadAsset(key);
          dependNode=loadNode(stream,ln);
        }
        node.addDependency(dependNode);
      }
    }
 else {
      sb.append(ln).append('\n');
    }
  }
  r.close();
  node.setSource(sb.toString());
  dependCache.put(nodeName,node);
  return node;
}
