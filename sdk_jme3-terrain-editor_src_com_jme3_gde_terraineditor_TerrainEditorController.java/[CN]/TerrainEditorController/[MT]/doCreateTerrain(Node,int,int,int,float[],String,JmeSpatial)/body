{
  AssetManager manager=SceneApplication.getApplication().getAssetManager();
  Terrain terrain=new TerrainQuad("terrain-" + sceneName,patchSize,totalSize,heightmapData);
  com.jme3.material.Material mat=new com.jme3.material.Material(manager,"Common/MatDefs/Terrain/TerrainLighting.j3md");
  String assetFolder="";
  if (manager != null && manager instanceof ProjectAssetManager)   assetFolder=((ProjectAssetManager)manager).getAssetFolderName();
  for (int i=0; i < NUM_ALPHA_TEXTURES; i++) {
    BufferedImage alphaBlend=new BufferedImage(alphaTextureSize,alphaTextureSize,BufferedImage.TYPE_INT_ARGB);
    if (i == 0) {
      for (int h=0; h < alphaTextureSize; h++)       for (int w=0; w < alphaTextureSize; w++)       alphaBlend.setRGB(w,h,0x00FF0000);
    }
    File alphaFolder=new File(assetFolder + "/Textures/terrain-alpha/");
    if (!alphaFolder.exists())     alphaFolder.mkdir();
    String alphaBlendFileName="/Textures/terrain-alpha/" + sceneName + "-"+ ((Node)terrain).getName()+ "-alphablend"+ i+ ".png";
    File alphaImageFile=new File(assetFolder + alphaBlendFileName);
    ImageIO.write(alphaBlend,"png",alphaImageFile);
    Texture tex=manager.loadAsset(new TextureKey(alphaBlendFileName,false));
    if (i == 0)     mat.setTexture("AlphaMap",tex);
 else     if (i == 1)     mat.setTexture("AlphaMap_1",tex);
 else     if (i == 2)     mat.setTexture("AlphaMap_2",tex);
  }
  Texture defaultTexture=manager.loadTexture(DEFAULT_TERRAIN_TEXTURE);
  defaultTexture.setWrap(WrapMode.Repeat);
  mat.setTexture("DiffuseMap",defaultTexture);
  mat.setFloat("DiffuseMap_0_scale",DEFAULT_TEXTURE_SCALE);
  mat.setBoolean("WardIso",true);
  ((Node)terrain).setMaterial(mat);
  ((Node)terrain).setModelBound(new BoundingBox());
  ((Node)terrain).updateModelBound();
  ((Node)terrain).setLocalTranslation(0,0,0);
  ((Node)terrain).setLocalScale(4f,1f,4f);
  TerrainLodControl control=new TerrainLodControl(terrain,SceneApplication.getApplication().getCamera());
  ((Node)terrain).addControl(control);
  parent.attachChild((Node)terrain);
  setNeedsSave(true);
  addSpatialUndo(parent,(Node)terrain,jmeNodeParent);
  return terrain;
}
