{
  int texId=img.getId();
  if (texId == -1) {
    glGenTextures(ib1);
    texId=ib1.get(0);
    img.setId(texId);
    objManager.registerObject(img);
    statistics.onNewTexture();
  }
  int target=convertTextureType(type);
  if (context.boundTextures[unit] != img) {
    glEnable(target);
    glBindTexture(target,texId);
    context.boundTextures[unit]=img;
    statistics.onTextureUse(img,true);
  }
  if (!ctxCaps.GL_ARB_texture_non_power_of_two && img.isNPOT()) {
    MipMapGenerator.resizeToPowerOf2(img);
  }
  if (!img.hasMipmaps() && img.isGeneratedMipmapsRequired()) {
    if (ctxCaps.OpenGL14) {
      glTexParameteri(target,GL14.GL_GENERATE_MIPMAP,GL_TRUE);
    }
 else {
      MipMapGenerator.generateMipMaps(img);
    }
    img.setMipmapsGenerated(true);
  }
 else {
  }
  if (img.getWidth() > maxTexSize || img.getHeight() > maxTexSize) {
    throw new RendererException("Cannot upload texture " + img + ". The maximum supported texture resolution is "+ maxTexSize);
  }
  TextureUtil.uploadTexture(ctxCaps,img,target,0,0,false);
  img.clearUpdateNeeded();
}
