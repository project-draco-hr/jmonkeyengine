{
  int texId=img.getId();
  GL gl=GLContext.getCurrentGL();
  if (texId == -1) {
    gl.glGenTextures(1,ib1);
    texId=ib1.get(0);
    img.setId(texId);
    objManager.registerForCleanup(img);
    statistics.onNewTexture();
  }
  int target=convertTextureType(type);
  if (context.boundTextures[unit] != img) {
    gl.glEnable(target);
    gl.glBindTexture(target,texId);
    context.boundTextures[unit]=img;
    statistics.onTextureUse(img,true);
  }
  if (!gl.isExtensionAvailable("GL_ARB_texture_non_power_of_two")) {
    if (img.getWidth() != 0 && img.getHeight() != 0) {
      if (!FastMath.isPowerOfTwo(img.getWidth()) || !FastMath.isPowerOfTwo(img.getHeight())) {
        MipMapGenerator.resizeToPowerOf2(img);
      }
    }
  }
  if (!img.hasMipmaps() && img.isGeneratedMipmapsRequired()) {
    if (gl.isExtensionAvailable("GL_VERSION_1_4")) {
      gl.glTexParameteri(target,GL2.GL_GENERATE_MIPMAP,GL.GL_TRUE);
    }
 else {
      MipMapGenerator.generateMipMaps(img);
    }
    img.setMipmapsGenerated(true);
  }
 else {
  }
  if (img.getWidth() > maxTexSize || img.getHeight() > maxTexSize) {
    throw new RendererException("Cannot upload texture " + img + ". The maximum supported texture resolution is "+ maxTexSize);
  }
  TextureUtil.uploadTexture(img,target,0,0);
  img.clearUpdateNeeded();
}
