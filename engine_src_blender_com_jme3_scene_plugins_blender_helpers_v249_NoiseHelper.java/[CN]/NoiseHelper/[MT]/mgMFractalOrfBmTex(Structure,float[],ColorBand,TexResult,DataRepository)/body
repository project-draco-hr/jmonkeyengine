{
  int stype=((Number)tex.getFieldValue("stype")).intValue();
  float nsOutscale=((Number)tex.getFieldValue("ns_outscale")).floatValue();
  float nabla=((Number)tex.getFieldValue("nabla")).floatValue();
  float noisesize=((Number)tex.getFieldValue("noisesize")).floatValue();
  float contrast=((Number)tex.getFieldValue("contrast")).floatValue();
  float brightness=((Number)tex.getFieldValue("bright")).floatValue();
  MusgraveFunction mgravefunc=stype == TEX_MFRACTAL ? musgraveFunctions.get(Integer.valueOf(stype)) : musgraveFunctions.get(Integer.valueOf(TEX_FBM));
  texres.tin=nsOutscale * mgravefunc.execute(tex,texvec[0],texvec[1],texvec[2]);
  if (texres.nor != null) {
    float offs=nabla / noisesize;
    texres.nor[0]=nsOutscale * mgravefunc.execute(tex,texvec[0] + offs,texvec[1],texvec[2]);
    texres.nor[1]=nsOutscale * mgravefunc.execute(tex,texvec[0],texvec[1] + offs,texvec[2]);
    texres.nor[2]=nsOutscale * mgravefunc.execute(tex,texvec[0],texvec[1],texvec[2] + offs);
    this.texNormalDerivate(colorBand,texres,dataRepository);
  }
  this.brightnesAndContrast(texres,contrast,brightness);
}
