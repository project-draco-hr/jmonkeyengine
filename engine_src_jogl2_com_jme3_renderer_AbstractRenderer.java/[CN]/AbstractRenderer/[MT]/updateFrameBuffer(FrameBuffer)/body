{
  int id=fb.getId();
  if (id == -1) {
    id=genFramebufferId();
    fb.setId(id);
    objManager.registerForCleanup(fb);
    statistics.onNewFrameBuffer();
  }
  if (context.boundFBO != id) {
    bindFramebuffer(id);
    context.boundDrawBuf=0;
    context.boundFBO=id;
  }
  FrameBuffer.RenderBuffer depthBuf=fb.getDepthBuffer();
  if (depthBuf != null) {
    updateFrameBufferAttachment(fb,depthBuf);
  }
  for (int i=0; i < fb.getNumColorBuffers(); i++) {
    FrameBuffer.RenderBuffer colorBuf=fb.getColorBuffer(i);
    updateFrameBufferAttachment(fb,colorBuf);
  }
  fb.clearUpdateNeeded();
}
