{
  AssetCache cache=handler.getCache(SimpleAssetCache.class);
  Shader shader=(Shader)cache.getFromCache(key);
  if (shader == null) {
    if (key.isUsesShaderNodes()) {
      if (shaderGenerator == null) {
        throw new UnsupportedOperationException("ShaderGenerator was not initialized, make sure assetManager.getGenerator(caps) has been called");
      }
      shader=shaderGenerator.generateShader();
    }
 else {
      shader=new Shader();
      shader.initialize();
      for (      Shader.ShaderType shaderType : key.getUsedShaderPrograms()) {
        shader.addSource(shaderType,key.getShaderProgramName(shaderType),(String)loadAsset(new AssetKey(key.getShaderProgramName(shaderType))),key.getDefines().getCompiled(),key.getShaderProgramLanguage(shaderType));
      }
    }
    cache.addToCache(key,shader);
  }
  return shader;
}
