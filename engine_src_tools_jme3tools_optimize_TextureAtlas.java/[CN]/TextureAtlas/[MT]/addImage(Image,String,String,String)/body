{
  if (rootMapName == null) {
    rootMapName=mapName;
  }
  if (sourceTextureName == null && !rootMapName.equals(mapName)) {
    throw new IllegalStateException("Cannot add texture " + name + " to new map without source texture.");
  }
  TextureAtlasTile location=locationMap.get(name);
  if (location != null) {
    locationMap.put(name,location);
    return true;
  }
 else   if (sourceTextureName == null) {
    Node node=root.insert(image);
    if (node == null) {
      return false;
    }
    location=node.location;
  }
 else {
    location=locationMap.get(sourceTextureName);
    if (location == null) {
      throw new IllegalStateException("Cannot find source texture for " + name + ".");
    }
 else     if (location.width != image.getWidth() || location.height != image.getHeight()) {
      throw new IllegalStateException("Secondary texture " + name + " does not fit main texture size.");
    }
  }
  locationMap.put(name,location);
  drawImage(image,location.getX(),location.getY(),mapName);
  return true;
}
