{
  device=GraphicsEnvironment.getLocalGraphicsEnvironment().getDefaultScreenDevice();
  GLCapabilities caps=new GLCapabilities(GLProfile.getMaxFixedFunc(true));
  caps.setHardwareAccelerated(true);
  caps.setDoubleBuffered(true);
  caps.setStencilBits(settings.getStencilBits());
  caps.setDepthBits(settings.getDepthBits());
  if (settings.getSamples() > 1) {
    caps.setSampleBuffers(true);
    caps.setNumSamples(settings.getSamples());
  }
  canvas=new GLCanvas(caps){
    @Override public void addNotify(){
      super.addNotify();
      onCanvasAdded();
    }
    @Override public void removeNotify(){
      onCanvasRemoved();
      super.removeNotify();
    }
  }
;
  canvas.invoke(false,new GLRunnable(){
    public boolean run(    GLAutoDrawable glad){
      canvas.getGL().setSwapInterval(settings.isVSync() ? 1 : 0);
      return true;
    }
  }
);
  canvas.setFocusable(true);
  canvas.requestFocus();
  canvas.setSize(settings.getWidth(),settings.getHeight());
  canvas.setIgnoreRepaint(true);
  canvas.addGLEventListener(this);
  if (settings.getBoolean("GraphicsDebug")) {
    canvas.invoke(false,new GLRunnable(){
      public boolean run(      GLAutoDrawable glad){
        GL gl=glad.getGL();
        if (gl.isGL4bc()) {
          canvas.setGL(new DebugGL4bc(gl.getGL4bc()));
        }
        return true;
      }
    }
);
  }
  renderer=new JoglRenderer();
}
