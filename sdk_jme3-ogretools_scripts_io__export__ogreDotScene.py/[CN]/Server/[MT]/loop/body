def loop(self, none):
    self.active = True
    prev = time.time()
    while self.active:
        if (not self.ready.locked()):
            time.sleep(0.001)
        else:
            now = time.time()
            if ((now - prev) > 0.066):
                actob = None
                try:
                    actob = bpy.context.active_object
                except:
                    pass
                if (not actob):
                    continue
                prev = now
                sel = bpy.context.active_object
                msg = self.sync()
                self.ready.release()
                self.stream(msg)
                if self.buffer:
                    bin = self.buffer.pop()
                    try:
                        self.socket.sendall(bin)
                    except:
                        print 'SERVER: send data error'
                        time.sleep(0.5)
                        pass
                else:
                    print 'SERVER: empty buffer'
            else:
                self.ready.release()
    print 'SERVER: thread exit'
