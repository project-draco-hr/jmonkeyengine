{
  List<Float>[] knots=new List[2];
  Pointer[] pKnots=new Pointer[]{(Pointer)nurb.getFieldValue("knotsu"),(Pointer)nurb.getFieldValue("knotsv")};
  for (int i=0; i < knots.length; ++i) {
    if (pKnots[i].isNotNull()) {
      FileBlockHeader fileBlockHeader=blenderContext.getFileBlock(pKnots[i].getOldMemoryAddress());
      BlenderInputStream blenderInputStream=blenderContext.getInputStream();
      blenderInputStream.setPosition(fileBlockHeader.getBlockPosition());
      int knotsAmount=fileBlockHeader.getCount() * fileBlockHeader.getSize() / 4;
      knots[i]=new ArrayList<Float>(knotsAmount);
      for (int j=0; j < knotsAmount; ++j) {
        knots[i].add(Float.valueOf(blenderInputStream.readFloat()));
      }
    }
  }
  int flagU=((Number)nurb.getFieldValue("flagu")).intValue();
  int flagV=((Number)nurb.getFieldValue("flagv")).intValue();
  int orderU=((Number)nurb.getFieldValue("orderu")).intValue();
  int orderV=((Number)nurb.getFieldValue("orderv")).intValue();
  int pntsU=((Number)nurb.getFieldValue("pntsu")).intValue();
  int pntsV=((Number)nurb.getFieldValue("pntsv")).intValue();
  List<Structure> bPoints=((Pointer)nurb.getFieldValue("bp")).fetchData(blenderContext.getInputStream());
  List<List<Vector4f>> controlPoints=new ArrayList<List<Vector4f>>(pntsV);
  for (int i=0; i < pntsV; ++i) {
    List<Vector4f> uControlPoints=new ArrayList<Vector4f>(pntsU);
    for (int j=0; j < pntsU; ++j) {
      DynamicArray<Float> vec=(DynamicArray<Float>)bPoints.get(j + i * pntsU).getFieldValue("vec");
      if (fixUpAxis) {
        uControlPoints.add(new Vector4f(vec.get(0).floatValue(),vec.get(2).floatValue(),-vec.get(1).floatValue(),vec.get(3).floatValue()));
      }
 else {
        uControlPoints.add(new Vector4f(vec.get(0).floatValue(),vec.get(1).floatValue(),vec.get(2).floatValue(),vec.get(3).floatValue()));
      }
    }
    if ((flagU & 0x01) != 0) {
      for (int k=0; k < orderU - 1; ++k) {
        uControlPoints.add(uControlPoints.get(k));
      }
    }
    controlPoints.add(uControlPoints);
  }
  if ((flagV & 0x01) != 0) {
    for (int k=0; k < orderV - 1; ++k) {
      controlPoints.add(controlPoints.get(k));
    }
  }
  int resolu=((Number)nurb.getFieldValue("resolu")).intValue() + 1;
  List<Geometry> result;
  if (knots[1] == null) {
    Spline nurbSpline=new Spline(controlPoints.get(0),knots[0]);
    Curve nurbCurve=new Curve(nurbSpline,resolu);
    if (bevelObject != null) {
      result=this.applyBevelAndTaper(nurbCurve,bevelObject,taperObject,true,blenderContext);
    }
 else {
      result=new ArrayList<Geometry>(1);
      Geometry nurbGeometry=new Geometry("",nurbCurve);
      result.add(nurbGeometry);
    }
  }
 else {
    int resolv=((Number)nurb.getFieldValue("resolv")).intValue() + 1;
    Surface nurbSurface=Surface.createNurbsSurface(controlPoints,knots,resolu,resolv,orderU,orderV);
    Geometry nurbGeometry=new Geometry("",nurbSurface);
    result=new ArrayList<Geometry>(1);
    result.add(nurbGeometry);
  }
  return result;
}
