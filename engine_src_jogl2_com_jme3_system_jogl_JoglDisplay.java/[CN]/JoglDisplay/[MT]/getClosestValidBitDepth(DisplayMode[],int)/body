{
  final int validBitsPerPixels;
  boolean isBitDepthValid=false;
  for (  DisplayMode mode : modes) {
    if (mode != null && mode.getBitDepth() == bpp) {
      isBitDepthValid=true;
      break;
    }
  }
  if (!isBitDepthValid) {
    int bestSupportedBitDepth=Integer.MAX_VALUE;
    int biggestBitDepth=-Integer.MIN_VALUE;
    for (    DisplayMode mode : modes) {
      if (mode != null) {
        if (Math.abs(mode.getBitDepth() - bpp) < Math.abs(bestSupportedBitDepth - bpp)) {
          bestSupportedBitDepth=mode.getBitDepth();
        }
        if (mode.getBitDepth() > biggestBitDepth) {
          biggestBitDepth=mode.getBitDepth();
        }
      }
    }
    if (bestSupportedBitDepth == Integer.MAX_VALUE) {
      validBitsPerPixels=biggestBitDepth;
    }
 else {
      validBitsPerPixels=bestSupportedBitDepth;
    }
  }
 else {
    validBitsPerPixels=bpp;
  }
  return validBitsPerPixels;
}
