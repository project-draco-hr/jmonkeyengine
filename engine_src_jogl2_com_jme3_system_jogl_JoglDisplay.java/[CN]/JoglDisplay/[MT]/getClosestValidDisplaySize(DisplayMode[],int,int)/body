{
  Dimension validDisplaySize=new Dimension(width,height);
  if (width <= 0 || height <= 0) {
    validDisplaySize.width=device.getDisplayMode().getWidth();
    validDisplaySize.height=device.getDisplayMode().getHeight();
  }
 else {
    boolean isDimensionValid=false;
    for (    DisplayMode mode : modes) {
      if (mode.getWidth() == width && mode.getHeight() == height) {
        isDimensionValid=true;
        break;
      }
    }
    if (!isDimensionValid) {
      int bestSupportedWidth=Integer.MAX_VALUE;
      int bestSupportedHeight=Integer.MAX_VALUE;
      int biggestSupportedWidth=Integer.MIN_VALUE;
      int biggestSupportedHeight=Integer.MIN_VALUE;
      for (      DisplayMode mode : modes) {
        if (Math.abs(mode.getWidth() - width) < Math.abs(bestSupportedWidth - width)) {
          bestSupportedWidth=mode.getWidth();
          bestSupportedHeight=mode.getHeight();
        }
        if (mode.getWidth() > biggestSupportedWidth) {
          biggestSupportedWidth=mode.getWidth();
          biggestSupportedHeight=mode.getHeight();
        }
      }
      if (bestSupportedWidth == Integer.MAX_VALUE) {
        validDisplaySize.width=biggestSupportedWidth;
        validDisplaySize.height=biggestSupportedHeight;
      }
 else {
        validDisplaySize.width=bestSupportedWidth;
        validDisplaySize.height=bestSupportedHeight;
      }
    }
  }
  for (int modeIndex=0; modeIndex < modes.length; modeIndex++) {
    if (modes[modeIndex] != null && modes[modeIndex].getWidth() != validDisplaySize.width && modes[modeIndex].getHeight() != validDisplaySize.height) {
      modes[modeIndex]=null;
    }
  }
  return validDisplaySize;
}
