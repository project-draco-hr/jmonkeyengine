{
  Pointer ppMaterials=(Pointer)structureWithMaterials.getFieldValue("mat");
  Material[] materials=null;
  if (!ppMaterials.isNull()) {
    List<Structure> materialStructures=ppMaterials.fetchData(dataRepository.getInputStream());
    if (materialStructures != null && materialStructures.size() > 0) {
      MaterialHelper materialHelper=dataRepository.getHelper(MaterialHelper.class);
      materials=new Material[materialStructures.size()];
      int i=0;
      for (      Structure s : materialStructures) {
        Material material=(Material)dataRepository.getLoadedFeature(s.getOldMemoryAddress(),LoadedFeatureDataType.LOADED_FEATURE);
        if (material == null) {
          material=materialHelper.toMaterial(s,dataRepository);
        }
        materials[i++]=material;
      }
    }
  }
  return materials;
}
