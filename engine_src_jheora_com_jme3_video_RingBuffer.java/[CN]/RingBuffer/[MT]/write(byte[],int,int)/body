{
  if (length == 0)   return;
synchronized (lock) {
    while (remainingForWrite() < length) {
      System.out.println("Warning: Audio decoder starved, waiting for player");
      try {
        lock.wait();
      }
 catch (      InterruptedException ex) {
      }
    }
    if (writePos >= readPos) {
      int l=Math.min(length,bufSize - writePos);
      System.arraycopy(data,offset,buf,writePos,l);
      writePos+=l;
      if (writePos >= bufSize)       writePos=0;
      if (length > l)       write(data,offset + l,length - l);
    }
 else {
      int l=Math.min(length,readPos - writePos - 1);
      System.arraycopy(data,offset,buf,writePos,l);
      writePos+=l;
      if (writePos >= bufSize)       writePos=0;
    }
    totalWritten+=length;
  }
}
