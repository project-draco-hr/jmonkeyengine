{
  IndexBuffer inBuf=mesh.getIndexBuffer();
  if (inBuf == null) {
    inBuf=new VirtualIndexBuffer(mesh.getVertexCount(),mesh.getMode());
  }
 else {
    inBuf=new WrappedIndexBuffer(mesh);
  }
  IndexBuffer outBuf;
  if (inBuf.size() > Short.MAX_VALUE * 2) {
    outBuf=new IndexIntBuffer(BufferUtils.createIntBuffer(inBuf.size()));
  }
 else {
    outBuf=new IndexShortBuffer(BufferUtils.createShortBuffer(inBuf.size()));
  }
  for (int i=0; i < inBuf.size(); i++) {
    outBuf.put(i,inBuf.get(i));
  }
  mesh.clearBuffer(Type.Index);
  mesh.setMode(Mode.Triangles);
  if (outBuf instanceof IndexIntBuffer) {
    mesh.setBuffer(Type.Index,3,(IntBuffer)outBuf.getBuffer());
  }
 else {
    mesh.setBuffer(Type.Index,3,(ShortBuffer)outBuf.getBuffer());
  }
}
